
{% extends 'core/base.html' %}
{% load static %}
{% block style %}
{% load mathfilters %}
  <link href="{% static 'core/assets/css/homepage.css' %}" rel="stylesheet">
{% endblock %}


{% block content %}

<main id="main" class="main">

  {% if is_match_live %}
    <hr class="marquee-hr"/>
      <marquee>A match is live, your points will be added once the match ends.</marquee>
    <hr class="marquee-hr"/>
  {% endif %}

  
    
    <div class="message-div">
      {% for message in messages %}
        <div class="container-fluid mt-1 mx-1">
          <div
            class="alert {{ message.tags }} alert-dismissible fade show"
            role="alert"
          >
            {{ message }}
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="alert"
              aria-label="Close"
            ></button>
          </div>
        </div>
      {% endfor %}
    </div>

    <div class="pagetitle">
      <h1>Dashboard</h1>
      <nav>
        <ol class="breadcrumb">
          {% comment %} <li class="breadcrumb-item"><a href="{% url 'home-page' %}">Home</a></li> {% endcomment %}
          <li class="breadcrumb-item active">Dashboard</li>
        </ol>
      </nav>
    </div>
    <!-- End Page Title -->

    <section class="section dashboard">
      <div class="row">

        <!-- Left side columns -->
        <div class="col-lg-8">
          
            {% if is_match_live %}
            <div class="row">
              <div class="card">
                <div class="card-body">
                  <div class="row">
                      <div class="col-9">
                          <h5 class="card-title">Live Score <span>| {{ live_match_name|title }} </span></h5>
                      </div>
                      <div class="col-3">
                          <div id="refresh"><i class="bi bi-arrow-clockwise refresh-icon"></i></div>
                      </div>
                  </div>
                  <div id="live-score-div"></div>
                </div>
              </div>
            </div>


              
            {% endif %}


            <!-- Daily Predictions -->
            {% if request.user %}
              {% for match, value in new_predictions.items %}
                <div class="col-12">
                  <div class="card recent-sales overflow-auto">
                    <div class="card-body">
                      <h5 class="card-title">{{ match.name|title }} <span>| Daily Prediction</span></h5>
                        {% if value.prediction %}
                        <form class="row g-3" action="{% url 'predict-results' match.id %}" method="POST"> 
                          {% csrf_token %}                 
                          <div class="col-md-12">
                              <div class="form-floating mb-3">
                                  <select class="form-select" id="floatingSelect" aria-label="State" name="match_predict_{{ match.id }}" required>                                   
                                      <option value="{{value.prediction}}">{{ value.prediction|title }}</option>                                    
                                  </select>
                                  <label for="floatingSelect"> Predicted </label>
                              </div>
                          </div>  
                          <div class="text-center">
                            <button type="submit" disabled class="btn btn-primary">Predict</button>
                          </div>   
                        </form>
                        {% else %}
                          <form class="row g-3" action="{% url 'predict-results' match.id %}" method="POST"> 
                            {% csrf_token %}                 
                            <div class="col-md-12">
                                <div class="form-floating mb-3">
                                    <select class="form-select" id="floatingSelect" aria-label="State" name="match_predict_{{ match.id }}" required>
                                      <option disabled selected value> -- select an option -- </option>    
                                      {% for result in value.result %}  
                                        <option value="{{result}}">{{ result|title }}</option>  
                                      {% endfor %}
                                    </select>
                                    <label for="floatingSelect"> Predict result</label>
                                </div>
                            </div>  
                            <div class="text-center">
                              <button type="submit" class="btn btn-primary">Predict</button>
                            </div>   
                          </form>
                        {% endif %}
                      
                    </div>
                  </div>
                </div>
              {% endfor %}
            {% endif %}

            <!-- Overall Player Points -->
            <div class="col-12">
              <div class="card recent-sales overflow-auto">
                <div class="card-body" >
                  <h5 class="card-title">User Points <span>| Overall</span></h5>
                  <table class="table table-hover datatable" id="user_points">
                    <thead>
                      <tr>
                        {% comment %} <th scope="col">#</th> {% endcomment %}
                        <th scope="col">Rank</th>
                        <th scope="col">User</th>
                        <th scope="col">Total</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for user in users %}
                      <tr>
                        <td class="table-content"><span class="badge bg-success">{{ user.rank }}</span></td>
                        <td class="table-content"><a href="{% url 'profile' user.user.id %}" class="text-primary">{{ user.user.username|title }}</a></td>
                        <td class="table-content"><span class="badge bg-success">{{ user.total_score }}</span></td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
            </div><!-- End Overall User Points -->

            <div class="col-12">
              <div class="card recent-sales overflow-auto">

                <div class="card-body" >
                  <h5 class="card-title">Player Points <span>| Overall</span></h5>

                  <table class="table table-hover datatable" id="player_points">
                    <thead>
                      <tr>
                        <th scope="col">Player</th>
                        <th scope="col">Bat</th>
                        <th scope="col">Bowl</th>
                        <th scope="col">Total</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for player in players %}
                      <tr>
                        {% comment %} <th scope="row"><a href="#">#</a></th> {% endcomment %}
                        <td class="table-content"><a href="{% url 'player-stats' %}?player_id={{ player.id }}" class="text-primary">{{ player.name|title }}</a></td>
                        <td class="table-content">{{ player.bat_points }}</td>
                        <td class="table-content">{{ player.bowl_points }}</td>
                        <td class="table-content"><span class="badge bg-success">{{ player.total_points }}</span></td>
                      </tr>
                      {% endfor %}
        
                    </tbody>
                  </table>

                </div>

              </div>
            </div><!-- End Overall Player Points -->
        </div><!-- End Left side columns -->

        <!-- Right side columns -->
        <div class="col-lg-4">

          <!-- Sales Card -->
            <div class="card info-card sales-card">
              <div class="card-body">
                <h5 class="card-title">MVP<span> | Most Points </span></h5>
                <div class="d-flex align-items-center">
                  <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                    <img class="img-icon" src={% static 'core/assets/img/bat-ball.png' %}></img>
                  </div>
                  <div class="ps-3">
                    <h5> {{ players.0.name|title }} - {{ players.0.total_points }} </h5>
                  </div>
                </div>
              </div>
            </div>

            <div class="card info-card revenue-card">
              <div class="card-body">
                <h5 class="card-title">Batting <span>| Most Runs </span></h5>
                <div class="d-flex align-items-center">
                  <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                   <img class="img-icon" src={% static 'core/assets/img/bat.png' %}></img>
                  </div>
                  <div class="ps-3">
                    <h5>{{ best_batsman.name|title }} - {{ best_batsman.bat_points }}  </h5>
                  </div>
                </div>
              </div>
            </div>

            <div class="card info-card customers-card">
              <div class="card-body">
                <h5 class="card-title">Bowling <span>| Most Wickets</span></h5>
                <div class="d-flex align-items-center">
                  <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                    {% comment %} <i class="bi bi-people"></i> {% endcomment %}
                    <img class="img-icon" src={% static 'core/assets/img/ball.png' %}></img>
                  </div>
                  <div class="ps-3">
                    <h5> {{ best_bowler.name|title }} - {{ best_bowler.bowl_points|div:25  }}</h5>
                  </div>
                </div>
              </div>
            </div>
        </div><!-- End Right side columns -->
      </div>
    </section>
  </main><!-- End #main -->

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
  <script src='https://cdn.rawgit.com/pguso/jquery-plugin-circliful/master/js/jquery.circliful.min.js'></script>
  <script src="http://code.jquery.com/ui/1.10.2/jquery-ui.js" ></script>

  <script>
    $(document).ready(function(){
      get_live_score()
    });
    document.getElementById("refresh").onclick = function(){
      get_live_score();
    }

    function get_live_score(){
      $.ajax({
        type:"GET",
        url: "{% url 'get-live-score' live_match_id %}",
        success: function(data){
          $('#live-score-div').html(data);
        }
      })
    }
  </script>

{% endblock %}